# Setting up a Single Node Elasticsearrch Cluster

## Instructions to Setup a Virtualization Platform
The virtual elasticsearch platform can be installed on either Oracle VirtualBox virtualization platform or Microsoft Hyper-V platform

The installation and most of the configuration is fully automated except for setting up the Service Token using a infrastructure as a code platform called Vagrant. Vagrant is a software from HarshiCorp Software foundation. We have to download and install the latest Vagrant software into your desktop. Vagrant is supported on both Windows and Linux. 

Once Vagrant and the Virtualization Hypervisor Platform is ready, we have to just run the below command. 

Microsoft Hyper-V
Start the Windows Command Prompt or PowerShell Terminal or New Windows Terminal in Administrator mode (Elivated Mode)

```dos
vagrant up --provider hyperv
```


Oracle VirtualBox
```dos
vagrant up 
```

Once the installation is done. We have to look at the installation log and get the auto generated password for the elastic user. Keep that copied safely. But anyway we are going to reset that password to a common password for use of use. 

Let's check for the basic network configuration in the operating system

```bash
# Check whether the host name is properly set
sudo hostname
# Check whether the hosts file is properly configured
sudo cat /etc/hosts
# Check whether the hostname is resolvable
sudo ping elk-single-node
# Now let's try to get the default route setting obtained from dhcp
sudo ip route | grep default
# Now let's see the ip address
sudo ip addr
# Check for internet connectivity
sudo ping bing.com
```

## Setting a Static IP in a Hyper-V Virtual Machine
As of the date, Vagrant is unable to setup a static IP address in the virtual machine. 
Below configuration statements doesn't work. 

```yml
config.vm.network "public_network", bridge "Default Switch", ip "192.168.1.10"
config.vm.network "private_network", ip "192.168.1.10" 
```

Therefore, we have to perform a workaround to get a static ip setup for the virtual machines. 

First we have to comment find the Network Settings for a given Hyper-V virtual switch. The only way to find the network details is by powering on a virtual machine on dhcp mode and then finding the details of the given IP from the network switch. 

To do this we need to log into the virtual machine. 
```dos
vagrant ssh
```

Below command will give us the default network gateway 

```bash
# Check whether the host name is properly set
sudo hostname
# Check whether the hosts file is properly configured
sudo cat /etc/hosts
# Check whether the hostname is resolvable
sudo ping elk-single-node
# Now let's try to get the default route setting obtained from dhcp
sudo ip route | grep default
```

After that we need to find out the netmask and an example ip. The best way to get that details is by looking at the current DHCP IP settings as below. 

```bash
sudo ip addr
```

Looking at them we can decide a suitable IP address, with netmask and the default gateway to be used in the change-ip-to-static.sh script. 

Check for internet connectivity

```bash
# Check for internet connectivity
sudo ping bing.com
```

## Changing the password of the elastic user
The installation autogenerates a password for the builtin admin user - elastic. But since I had to automate most of the configurations in the elasticsearch lab setup, we need to change that autogenerated password into ucsc@1234

```bash
cd scripts/manually-configure
# let's check for the available scripts
ls -al 
# Run the full setup script
# This script will perform all the required configurations
./full-setup.sh

```
The full-setup script will take few minutes to finish the installation. Once the installation is done, open the local browser and try to access the Kibana UI 

![Kibana UI](/images/01-kibana-ui.png)

